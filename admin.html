<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ« - Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <style>
    :root{
      --bg:#020617;
      --card:rgba(15,23,42,0.98);
      --accent:#22d3ee;
      --accent2:#a855f7;
      --accent3:#facc15;
      --danger:#ef4444;
      --success:#10b981;
      --border:rgba(148,163,184,0.35);
      --text:#e5e7eb;
      --muted:#9ca3af;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Tajawal",system-ui,sans-serif;
      background:
        radial-gradient(circle at top,rgba(56,189,248,0.16),transparent 60%),
        radial-gradient(circle at bottom,rgba(168,85,247,0.16),transparent 55%),
        linear-gradient(135deg,#020617,#020617 40%,#030b1e);
      color:var(--text);
      min-height:100vh;
    }
    header{
      padding:10px 14px;
      border-bottom:1px solid var(--border);
      background:linear-gradient(90deg,rgba(15,23,42,0.98),rgba(15,23,42,0.9));
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .logo{display:flex;align-items:center;gap:10px;}
    .logo-icon{
      width:34px;height:34px;border-radius:50%;
      border:2px solid var(--accent);
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 0 18px rgba(34,211,238,0.7);
      background:radial-gradient(circle,rgba(34,211,238,0.2),transparent);
    }
    .logo-icon i{color:var(--accent);font-size:16px}
    .logo-text{display:flex;flex-direction:column;line-height:1.1}
    .logo-title{font-size:16px;font-weight:700}
    .logo-sub{font-size:11px;color:var(--muted)}
    .header-right{display:flex;align-items:center;gap:8px;font-size:11px;}
    .logout-btn{
      border:none;
      border-radius:999px;
      padding:4px 10px;
      font-size:11px;
      background:#ef4444;
      color:#fee2e2;
      cursor:pointer;
    }

    main{max-width:1100px;margin:14px auto 20px;padding:0 10px;}

    /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    #loginScreen{
      max-width:420px;
      margin:60px auto;
      background:var(--card);
      border-radius:16px;
      border:1px solid var(--border);
      padding:18px 16px;
      text-align:center;
      box-shadow:0 0 30px rgba(15,23,42,0.9);
    }
    #loginScreen h1{font-size:18px;margin-bottom:4px;}
    #loginScreen p{font-size:12px;color:var(--muted);margin-bottom:12px;}
    .login-input{
      width:100%;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(51,65,85,0.95);
      background:rgba(15,23,42,0.96);
      color:var(--text);
      font-size:13px;
      margin-bottom:10px;
    }
    .login-btn{
      width:100%;
      padding:8px 10px;
      border-radius:999px;
      border:none;
      background:linear-gradient(90deg,#22c55e,#16a34a);
      color:#022c22;
      font-size:13px;
      cursor:pointer;
      font-weight:600;
      margin-bottom:6px;
    }
    #loginError{font-size:12px;color:#fecaca;min-height:16px;}

    /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¯Ù…Ù† */
    #adminApp{display:none;}

    .tabs{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:14px;
    }
    .tab-btn{
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(15,23,42,0.96);
      color:var(--muted);
      font-size:12px;
      padding:6px 10px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .tab-btn.active{
      border-color:var(--accent);
      color:var(--accent);
      box-shadow:0 0 18px rgba(34,211,238,0.55);
    }

    .card{
      background:var(--card);
      border-radius:16px;
      border:1px solid var(--border);
      padding:14px 12px;
      margin-bottom:12px;
      font-size:13px;
    }
    .card h2{
      font-size:15px;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .card p{font-size:12px;color:var(--muted);margin-bottom:10px;}

    label{font-size:12px;color:var(--muted);display:block;margin-bottom:4px;}
    input[type="text"], input[type="number"], select{
      width:100%;
      padding:7px 9px;
      border-radius:10px;
      border:1px solid rgba(51,65,85,0.95);
      background:rgba(15,23,42,0.96);
      color:var(--text);
      font-size:13px;
      margin-bottom:8px;
    }
    textarea{
      width:100%;
      padding:7px 9px;
      border-radius:10px;
      border:1px solid rgba(51,65,85,0.95);
      background:rgba(15,23,42,0.96);
      color:var(--text);
      font-size:13px;
      margin-bottom:8px;
      min-height:80px;
    }
    .btn{
      border:none;
      border-radius:999px;
      padding:7px 12px;
      font-size:12px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-primary{
      background:linear-gradient(90deg,#22d3ee,#0ea5e9);
      color:#0b1120;
    }
    .btn-outline{
      background:transparent;
      border:1px solid var(--border);
      color:var(--muted);
    }
    .btn-danger{
      background:#b91c1c;
      color:#fee2e2;
    }
    .small{font-size:11px;color:var(--muted);}

    .resources-list{display:flex;flex-direction:column;gap:6px;margin-bottom:8px;}
    .resource-row{
      display:grid;
      grid-template-columns:2fr 2fr auto;
      gap:6px;
      align-items:center;
    }
    .status-msg{font-size:12px;margin-top:6px;}
    .status-ok{color:var(--success);}
    .status-err{color:#fecaca;}
  </style>
</head>

<body>

<header>
  <div class="logo">
    <div class="logo-icon"><i class="fa-solid fa-bolt"></i></div>
    <div class="logo-text">
      <div class="logo-title">ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ«</div>
      <div class="logo-sub">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† (Firebase)</div>
    </div>
  </div>
  <div class="header-right">
    <span id="adminStatusText">ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„</span>
    <button class="logout-btn" id="logoutBtn" style="display:none;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  </div>
</header>

<main>

  <!-- Ø´Ø§Ø´Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± -->
  <section id="loginScreen">
    <h1>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h1>
    <p>Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….</p>
    <input type="password" id="adminPassword" class="login-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
    <button class="login-btn" id="loginBtn">
      <i class="fa-solid fa-lock-open"></i>
      Ø¯Ø®ÙˆÙ„
    </button>
    <div id="loginError"></div>
    <div class="small" style="margin-top:8px;opacity:0.7;">
      ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø´ÙØ±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ØŒ ÙˆÙ„Ø§ ØªØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†.
    </div>
  </section>

  <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¯Ù…Ù† -->
  <section id="adminApp">
    <div class="tabs">
      <button class="tab-btn active" data-tab="addProduct"><i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
      <button class="tab-btn" data-tab="editProduct"><i class="fa-solid fa-pen-to-square"></i> ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬</button>
      <button class="tab-btn" data-tab="deleteProduct"><i class="fa-solid fa-trash"></i> Ø­Ø°Ù Ù…Ù†ØªØ¬</button>
      <button class="tab-btn" data-tab="vipUsers"><i class="fa-solid fa-crown"></i> ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨ VIP</button>
      <button class="tab-btn" data-tab="welcome"><i class="fa-solid fa-bullhorn"></i> Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ØªØ±Ø­ÙŠØ¨</button>
    </div>

    <!-- Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
    <div class="card tab-panel" id="tab-addProduct">
      <h2><i class="fa-solid fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
      <p>ÙƒÙ„ Ù…Ù†ØªØ¬ ÙŠÙ…Ø«Ù„ ÙƒÙˆØ±Ø³ Ø£Ùˆ Ø­Ø²Ù…Ø© Ù…Ù„ÙØ§Øª. ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¹Ø¯Ø¯ Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ (Ø±ÙˆØ§Ø¨Ø· Ù…ÙØªÙˆØ­Ø© Ø£Ùˆ VIP).</p>

      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
      <input type="text" id="pName" placeholder="Ù…Ø«Ø§Ù„: Ø¯ÙˆØ±Ø© ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">

      <label>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (1:1)</label>
      <input type="text" id="pImage" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ù…Ø±Ø¨Ø¹Ø© Ù„Ù„ÙƒÙˆØ±Ø³ Ù…Ù† Google Drive Ø£Ùˆ Ø£ÙŠ Ù…ÙˆÙ‚Ø¹ Ø¢Ø®Ø±">

      <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
      <select id="pCategory">
        <option value="course">ÙƒÙˆØ±Ø³ ØªØ¹Ù„ÙŠÙ…ÙŠ</option>
        <option value="app">ØªØ·Ø¨ÙŠÙ‚ / Ø¨Ø±Ù†Ø§Ù…Ø¬</option>
        <option value="script">Ø³ÙƒØ±Ø¨Øª / ÙƒÙˆØ¯</option>
        <option value="template">Ù‚Ø§Ù„Ø¨ Ø¬Ø§Ù‡Ø²</option>
        <option value="tool">Ø£Ø¯Ø§Ø© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ©</option>
        <option value="server">Ø³ÙŠØ±ÙØ±Ø§Øª / IPTV</option>
      </select>

      <div style="margin:6px 0 4px;font-size:12px;font-weight:600;">Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ø¹Ø¯Ø¯ Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠ)</div>
      <p class="small">ÙƒÙ„ Ø³Ø·Ø± = Ø­Ù‚Ù„ Ø¯Ø§Ø®Ù„ ØµÙØ­Ø© Ø§Ù„ÙƒÙˆØ±Ø³ (Ø¹Ù†ÙˆØ§Ù† + Ø±Ø§Ø¨Ø· + Ù†ÙˆØ¹: Ù…ÙØªÙˆØ­ Ù„Ù„Ø¬Ù…ÙŠØ¹ / VIP Ù„Ù„Ù…Ø´ØªØ±Ùƒ ÙÙ‚Ø·).</p>

      <div class="resources-list" id="resourcesList"></div>
      <button class="btn btn-outline" id="addResourceBtn">
        <i class="fa-solid fa-link"></i> Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø·
      </button>

      <div style="margin-top:10px;">
        <button class="btn btn-primary" id="saveProductBtn">
          <i class="fa-solid fa-floppy-disk"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬
        </button>
      </div>
      <div id="addStatus" class="status-msg"></div>
    </div>

    <!-- ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ -->
    <div class="card tab-panel" id="tab-editProduct" style="display:none;">
      <h2><i class="fa-solid fa-pen-to-square"></i> ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯</h2>
      <p>Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø± Ù„ÙŠØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ ÙˆØªØ¹Ø¯ÙŠÙ„Ù‡Ø§.</p>

      <label>ID Ø§Ù„Ù…Ù†ØªØ¬</label>
      <input type="number" id="editId" placeholder="Ù…Ø«Ø§Ù„: 1">

      <button class="btn btn-outline" id="loadProductBtn">
        <i class="fa-solid fa-magnifying-glass"></i> Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
      </button>

      <div id="editArea" style="margin-top:10px;display:none;">
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
        <input type="text" id="editName">

        <label>Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (1:1)</label>
        <input type="text" id="editImage">

        <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
        <select id="editCategory">
          <option value="course">ÙƒÙˆØ±Ø³ ØªØ¹Ù„ÙŠÙ…ÙŠ</option>
          <option value="app">ØªØ·Ø¨ÙŠÙ‚ / Ø¨Ø±Ù†Ø§Ù…Ø¬</option>
          <option value="script">Ø³ÙƒØ±Ø¨Øª / ÙƒÙˆØ¯</option>
          <option value="template">Ù‚Ø§Ù„Ø¨ Ø¬Ø§Ù‡Ø²</option>
          <option value="tool">Ø£Ø¯Ø§Ø© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ©</option>
          <option value="server">Ø³ÙŠØ±ÙØ±Ø§Øª / IPTV</option>
        </select>

        <div style="margin:6px 0 4px;font-size:12px;font-weight:600;">Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø­ØªÙˆÙ‰</div>
        <div class="small">ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†ØŒ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·ØŒ ÙˆÙ†ÙˆØ¹ Ø§Ù„ÙˆØµÙˆÙ„ (Ù…ÙØªÙˆØ­ / VIP).</div>

        <div class="resources-list" id="editResourcesList"></div>
        <button class="btn btn-outline" id="editAddResourceBtn">
          <i class="fa-solid fa-link"></i> Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯
        </button>

        <div style="margin-top:10px;">
          <button class="btn btn-primary" id="updateProductBtn">
            <i class="fa-solid fa-floppy-disk"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
          </button>
        </div>
      </div>
      <div id="editStatus" class="status-msg"></div>
    </div>

    <!-- Ø­Ø°Ù Ù…Ù†ØªØ¬ -->
    <div class="card tab-panel" id="tab-deleteProduct" style="display:none;">
      <h2><i class="fa-solid fa-trash-can"></i> Ø­Ø°Ù Ù…Ù†ØªØ¬</h2>
      <p>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ID Ù„Ù„Ù…Ù†ØªØ¬ (Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¸Ø§Ù‡Ø± ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±) Ù„ÙŠØªÙ… Ø­Ø°ÙÙ‡.</p>
      <label>ID Ø§Ù„Ù…Ù†ØªØ¬</label>
      <input type="number" id="delId" placeholder="Ù…Ø«Ø§Ù„: 1">
      <button class="btn btn-danger" id="deleteProductBtn">
        <i class="fa-solid fa-trash"></i> Ø­Ø°Ù
      </button>
      <div id="deleteStatus" class="status-msg"></div>
    </div>

    <!-- ØªÙØ¹ÙŠÙ„ VIP -->
    <div class="card tab-panel" id="tab-vipUsers" style="display:none;">
      <h2><i class="fa-solid fa-crown"></i> ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ù…Ø³ØªØ®Ø¯Ù… VIP</h2>
      <p>Ø§ÙƒØªØ¨ ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±ØŒ ÙˆØ§Ø®ØªØ± Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.</p>

      <label>ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
      <input type="text" id="vipUserId" placeholder="Ù…Ø«Ø§Ù„: U123456">

      <label>Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
      <select id="vipDuration">
        <option value="1">Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯ (5$)</option>
        <option value="3">3 Ø£Ø´Ù‡Ø± (10$)</option>
      </select>

      <button class="btn btn-primary" id="activateVipBtn">
        <i class="fa-solid fa-toggle-on"></i> ØªÙØ¹ÙŠÙ„ / ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
      </button>

      <div id="vipStatus" class="status-msg"></div>
    </div>

    <!-- Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
    <div class="card tab-panel" id="tab-welcome" style="display:none;">
      <h2><i class="fa-solid fa-bullhorn"></i> Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ØªØ±Ø­ÙŠØ¨</h2>
      <p>Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„ Ù…Ø±Ø© ÙŠÙØªØ­ Ø§Ù„Ù…ØªØ¬Ø±ØŒ Ù…Ø¹ Ø²Ø± "ØªØ®Ø·ÙŠ".</p>

      <label>ØªÙØ¹ÙŠÙ„ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ØªØ±Ø­ÙŠØ¨</label>
      <select id="welcomeEnabled">
        <option value="false">Ù…Ø¹Ø·Ù‘Ù„</option>
        <option value="true">Ù…ÙØ¹Ù‘Ù„</option>
      </select>

      <label>Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
      <textarea id="welcomeText" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ù†Øµ Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø£Ùˆ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø§Øµ..."></textarea>

      <button class="btn btn-primary" id="saveWelcomeBtn">
        <i class="fa-solid fa-floppy-disk"></i> Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
      </button>

      <div id="welcomeStatus" class="status-msg"></div>
    </div>
  </section>

</main>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDa_20ADHMOiUhueZL9PS3WHmA89fGLfhk",
    authDomain: "mtgr-5feb9.firebaseapp.com",
    projectId: "mtgr-5feb9",
    storageBucket: "mtgr-5feb9.firebasestorage.app",
    messagingSenderId: "1097780736802",
    appId: "1:1097780736802:web:89ea173d277ce529a56b7b",
    measurementId: "G-JWNEHDQ31F"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù…Ø´ÙØ±Ø© Base64: "BbZzAaMm" => "QmJaekFhTW0="
  const ADMIN_PASS_ENC = "QmJaekFhTW0=";

  // ğŸ”¹ Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø±Ø§Ø¨Ø· Google Drive Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© ØµØ§Ù„Ø­ (thumbnail)
  function normalizeDriveImageUrl(url){
    if(!url) return "";
    try{
      if(url.includes("drive.google.com/thumbnail")) return url;

      let fileId = null;

      // Ø´ÙƒÙ„: .../file/d/FILE_ID/view
      if(url.includes("/d/")){
        const m = url.match(/\/d\/([^/]+)/);
        if(m && m[1]) fileId = m[1];
      }

      // Ø´ÙƒÙ„: ...id=FILE_ID
      if(!fileId && url.includes("id=")){
        const m2 = url.match(/[?&]id=([^&]+)/);
        if(m2 && m2[1]) fileId = m2[1];
      }

      if(fileId){
        return "https://drive.google.com/thumbnail?id=" + fileId + "&sz=w1000";
      }
      return url;
    }catch(e){
      return url;
    }
  }

  const loginScreen = document.getElementById("loginScreen");
  const adminApp    = document.getElementById("adminApp");
  const loginBtn    = document.getElementById("loginBtn");
  const loginError  = document.getElementById("loginError");
  const passInput   = document.getElementById("adminPassword");
  const adminStatus = document.getElementById("adminStatusText");
  const logoutBtn   = document.getElementById("logoutBtn");

  const tabButtons = document.querySelectorAll(".tab-btn");
  const tabPanels  = document.querySelectorAll(".tab-panel");

  function showTab(id){
    tabButtons.forEach(btn=>{
      btn.classList.toggle("active", btn.dataset.tab === id);
    });
    tabPanels.forEach(panel=>{
      panel.style.display = panel.id === "tab-"+id ? "block" : "none";
    });
  }

  tabButtons.forEach(btn=>{
    btn.addEventListener("click", () => showTab(btn.dataset.tab));
  });

  function doLogin(){
    const entered = passInput.value.trim();
    const real = atob(ADMIN_PASS_ENC);
    if(entered === real){
      localStorage.setItem("FTM_ADMIN_LOGGED","1");
      loginScreen.style.display = "none";
      adminApp.style.display = "block";
      adminStatus.textContent = "Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù†";
      logoutBtn.style.display = "inline-flex";
      loginError.textContent = "";
    }else{
      loginError.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.";
    }
  }

  loginBtn.addEventListener("click", doLogin);
  passInput.addEventListener("keyup", e=>{
    if(e.key === "Enter") doLogin();
  });

  logoutBtn.addEventListener("click", ()=>{
    localStorage.removeItem("FTM_ADMIN_LOGGED");
    location.reload();
  });

  (function checkAdmin(){
    if(localStorage.getItem("FTM_ADMIN_LOGGED") === "1"){
      loginScreen.style.display = "none";
      adminApp.style.display = "block";
      adminStatus.textContent = "Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù†";
      logoutBtn.style.display = "inline-flex";
    }
  })();

  // ===== Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ =====
  const resourcesList   = document.getElementById("resourcesList");
  const addResourceBtn  = document.getElementById("addResourceBtn");
  const saveProductBtn  = document.getElementById("saveProductBtn");
  const addStatus       = document.getElementById("addStatus");

  function addResourceRow(parentList, title="", url="", access="public"){
    const row = document.createElement("div");
    row.className = "resource-row";
    row.innerHTML = `
      <input type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø·" value="${title}">
      <input type="text" placeholder="Ø±Ø§Ø¨Ø· (ÙÙŠØ¯ÙŠÙˆ / Ù…Ù„Ù / ØµÙØ­Ø©)" value="${url}">
      <select>
        <option value="public" ${access==="public"?"selected":""}>Ù…ÙØªÙˆØ­</option>
        <option value="vip" ${access==="vip"?"selected":""}>VIP</option>
      </select>
    `;
    parentList.appendChild(row);
  }

  addResourceBtn.addEventListener("click", ()=>addResourceRow(resourcesList));
  addResourceRow(resourcesList); // ÙˆØ§Ø­Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ

  async function getNextProductId(){
    const snap = await db.collection("products").orderBy("id","desc").limit(1).get();
    if(snap.empty) return 1;
    const last = snap.docs[0].data().id || 0;
    return last + 1;
  }

  saveProductBtn.addEventListener("click", async ()=>{
    const title = document.getElementById("pName").value.trim();
    let image   = document.getElementById("pImage").value.trim();
    const category = document.getElementById("pCategory").value || "course";

    if(!title){
      addStatus.textContent = "Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬.";
      addStatus.className = "status-msg status-err";
      return;
    }

    // ğŸ”¹ ØªØ­ÙˆÙŠÙ„ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø¯Ø±Ø§ÙŠÙ Ø¥Ù„Ù‰ thumbnail Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸
    image = normalizeDriveImageUrl(image);

    const rows = resourcesList.querySelectorAll(".resource-row");
    const resources = [];
    rows.forEach(row=>{
      const [tInput,uInput,sel] = row.querySelectorAll("input,select");
      const t = tInput.value.trim();
      const u = uInput.value.trim();
      const a = sel.value;
      if(t && u){
        resources.push({title:t,url:u,access:a});
      }
    });

    if(!resources.length){
      addStatus.textContent = "Ø£Ø¶Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø±Ø§Ø¨Ø· ÙˆØ§Ø­Ø¯ Ù„Ù„Ù…Ø­ØªÙˆÙ‰.";
      addStatus.className = "status-msg status-err";
      return;
    }

    const accessVip = resources.some(r=>r.access==="vip");

    try{
      const newId = await getNextProductId();
      await db.collection("products").doc(String(newId)).set({
        id:newId,
        title,
        image,
        category,
        resources,
        accessVip,
        createdAt:new Date().toISOString()
      });

      addStatus.textContent = `ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­. ID = ${newId}`;
      addStatus.className = "status-msg status-ok";

      document.getElementById("pName").value = "";
      document.getElementById("pImage").value = "";
      document.getElementById("pCategory").value = "course";
      resourcesList.innerHTML = "";
      addResourceRow(resourcesList);
    }catch(err){
      console.error(err);
      addStatus.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ù€ Firebase.";
      addStatus.className = "status-msg status-err";
    }
  });

  // ===== ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ =====
  const editIdInput        = document.getElementById("editId");
  const loadProductBtn     = document.getElementById("loadProductBtn");
  const editArea           = document.getElementById("editArea");
  const editNameInput      = document.getElementById("editName");
  const editImageInput     = document.getElementById("editImage");
  const editCategorySelect = document.getElementById("editCategory");
  const editResourcesList  = document.getElementById("editResourcesList");
  const editAddResourceBtn = document.getElementById("editAddResourceBtn");
  const updateProductBtn   = document.getElementById("updateProductBtn");
  const editStatus         = document.getElementById("editStatus");

  loadProductBtn.addEventListener("click", async ()=>{
    const id = editIdInput.value.trim();
    if(!id){
      editStatus.textContent = "Ø§ÙƒØªØ¨ ID Ø§Ù„Ù…Ù†ØªØ¬.";
      editStatus.className = "status-msg status-err";
      editArea.style.display = "none";
      return;
    }
    try{
      const doc = await db.collection("products").doc(String(id)).get();
      if(!doc.exists){
        editStatus.textContent = "Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.";
        editStatus.className = "status-msg status-err";
        editArea.style.display = "none";
        return;
      }
      const data = doc.data();
      editNameInput.value  = data.title || "";
      editImageInput.value = data.image || "";
      editCategorySelect.value = data.category || "course";

      editResourcesList.innerHTML = "";
      if(Array.isArray(data.resources) && data.resources.length){
        data.resources.forEach(r=>{
          addResourceRow(editResourcesList, r.title || "", r.url || "", r.access || "public");
        });
      }else{
        addResourceRow(editResourcesList);
      }

      editArea.style.display = "block";
      editStatus.textContent = "";
    }catch(err){
      console.error(err);
      editStatus.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
      editStatus.className = "status-msg status-err";
    }
  });

  editAddResourceBtn.addEventListener("click", ()=>{
    addResourceRow(editResourcesList);
  });

  updateProductBtn.addEventListener("click", async ()=>{
    const id = editIdInput.value.trim();
    if(!id){
      editStatus.textContent = "ID ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.";
      editStatus.className = "status-msg status-err";
      return;
    }

    const title = editNameInput.value.trim();
    let image   = editImageInput.value.trim();
    const category = editCategorySelect.value || "course";

    if(!title){
      editStatus.textContent = "Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ ÙØ§Ø±Øº.";
      editStatus.className = "status-msg status-err";
      return;
    }

    // ğŸ”¹ ØªØ­ÙˆÙŠÙ„ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø¯Ø±Ø§ÙŠÙ Ø¥Ø°Ø§ Ù„Ø²Ù…
    image = normalizeDriveImageUrl(image);

    const rows = editResourcesList.querySelectorAll(".resource-row");
    const resources = [];
    rows.forEach(row=>{
      const [tInput,uInput,sel] = row.querySelectorAll("input,select");
      const t = tInput.value.trim();
      const u = uInput.value.trim();
      const a = sel.value;
      if(t && u){
        resources.push({title:t,url:u,access:a});
      }
    });

    const accessVip = resources.some(r=>r.access==="vip");

    try{
      await db.collection("products").doc(String(id)).set({
        id:Number(id),
        title,
        image,
        category,
        resources,
        accessVip
      }, {merge:true});

      editStatus.textContent = "ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª.";
      editStatus.className = "status-msg status-ok";
    }catch(err){
      console.error(err);
      editStatus.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸.";
      editStatus.className = "status-msg status-err";
    }
  });

  // ===== Ø­Ø°Ù Ù…Ù†ØªØ¬ =====
  const delIdInput    = document.getElementById("delId");
  const deleteBtn     = document.getElementById("deleteProductBtn");
  const deleteStatus  = document.getElementById("deleteStatus");

  deleteBtn.addEventListener("click", async ()=>{
    const id = delIdInput.value.trim();
    if(!id){
      deleteStatus.textContent = "Ø§ÙƒØªØ¨ ID Ø§Ù„Ù…Ù†ØªØ¬.";
      deleteStatus.className = "status-msg status-err";
      return;
    }
    try{
      await db.collection("products").doc(String(id)).delete();
      deleteStatus.textContent = "ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ (Ø¥Ù† ÙˆØ¬Ø¯).";
      deleteStatus.className = "status-msg status-ok";
    }catch(err){
      console.error(err);
      deleteStatus.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù.";
      deleteStatus.className = "status-msg status-err";
    }
  });

  // ===== ØªÙØ¹ÙŠÙ„ VIP =====
  const vipUserIdInput = document.getElementById("vipUserId");
  const vipDurationSel = document.getElementById("vipDuration");
  const activateVipBtn = document.getElementById("activateVipBtn");
  const vipStatus      = document.getElementById("vipStatus");

  activateVipBtn.addEventListener("click", async ()=>{
    const uid = vipUserIdInput.value.trim();
    if(!uid){
      vipStatus.textContent = "Ø§ÙƒØªØ¨ ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….";
      vipStatus.className = "status-msg status-err";
      return;
    }
    const months = parseInt(vipDurationSel.value,10) || 1;
    const now = new Date();
    const until = new Date(now);
    until.setMonth(until.getMonth()+months);

    try{
      await db.collection("users").doc(uid).set({
        id:uid,
        isVip:true,
        vipUntil: until.toISOString()
      }, {merge:true});

      vipStatus.textContent = `ØªÙ… ØªÙØ¹ÙŠÙ„ VIP Ù„ØºØ§ÙŠØ©: ${until.toLocaleDateString("ar-IQ")}`;
      vipStatus.className = "status-msg status-ok";
    }catch(err){
      console.error(err);
      vipStatus.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙØ¹ÙŠÙ„.";
      vipStatus.className = "status-msg status-err";
    }
  });

  // ===== Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ØªØ±Ø­ÙŠØ¨ =====
  const welcomeEnabledSel = document.getElementById("welcomeEnabled");
  const welcomeTextArea   = document.getElementById("welcomeText");
  const welcomeStatus     = document.getElementById("welcomeStatus");
  const saveWelcomeBtn    = document.getElementById("saveWelcomeBtn");

  async function loadWelcomeConfig(){
    try{
      const doc = await db.collection("config").doc("store").get();
      if(doc.exists){
        const d = doc.data();
        welcomeEnabledSel.value = String(!!d.welcomeEnabled);
        welcomeTextArea.value   = d.welcomeText || "";
      }
    }catch(err){
      console.error(err);
    }
  }

  saveWelcomeBtn.addEventListener("click", async ()=>{
    const enabled = welcomeEnabledSel.value === "true";
    const text    = welcomeTextArea.value.trim();
    try{
      await db.collection("config").doc("store").set({
        welcomeEnabled: enabled,
        welcomeText: text
      }, {merge:true});
      welcomeStatus.textContent = "ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†.";
      welcomeStatus.className = "status-msg status-ok";
    }catch(err){
      console.error(err);
      welcomeStatus.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸.";
      welcomeStatus.className = "status-msg status-err";
    }
  });

  loadWelcomeConfig();
</script>

</body>
</html>
