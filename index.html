<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- ========== META & SEO ========== -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ« | ÙƒÙˆØ±Ø³Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© Ùˆ VIP - Ø¨Ø±Ø§Ù…Ø¬ Ù…Ù‡ÙƒØ±Ø© ÙˆÙ…Ø¹Ø¯Ù„Ø© ÙˆÙ‚ÙˆØ§Ù„Ø¨ ÙˆØ£Ø¯ÙˆØ§Øª</title>

  <meta name="description" content="ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ«: Ù…ØªØ¬Ø± ÙƒÙˆØ±Ø³Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© Ùˆ VIPØŒ Ø¨Ø±Ø§Ù…Ø¬ ØªØ¹Ù„ÙŠÙ…ØŒ Ø£Ø¯ÙˆØ§Øª ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ØŒ Ø¨Ø±Ø§Ù…Ø¬ Ù…Ù‡ÙƒØ±Ø© ÙˆÙ…Ø¹Ø¯Ù„Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŒ Ù‚ÙˆØ§Ù„Ø¨ Ø¬Ø§Ù‡Ø²Ø©ØŒ Ø³ÙƒØ±Ø¨ØªØ§ØªØŒ Ø³ÙŠØ±ÙØ±Ø§ØªØŒ ÙˆØ«ØºØ±Ø§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ©.">
  <meta name="keywords" content="ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ«, Ù…ØªØ¬Ø± ÙƒÙˆØ±Ø³Ø§Øª, ÙƒÙˆØ±Ø³Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©, ÙƒÙˆØ±Ø³Ø§Øª VIP, Ø¨Ø±Ø§Ù…Ø¬ ØªØ¹Ù„ÙŠÙ…, Ø¨Ø±Ø§Ù…Ø¬ Ù…Ù‡ÙƒØ±Ø©, Ø¨Ø±Ø§Ù…Ø¬ Ù…Ø¹Ø¯Ù„Ø©, Ø¨Ø±Ø§Ù…Ø¬ Ù‡ÙƒØ±, Ø«ØºØ±Ø§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ©, Ù‚ÙˆØ§Ù„Ø¨ Ø¬Ø§Ù‡Ø²Ø©, Ù‚ÙˆØ§Ù„Ø¨ Ø¨Ù„ÙˆØ¬Ø±, Ø³ÙƒØ±Ø¨ØªØ§Øª, Ø£Ø¯ÙˆØ§Øª Ø§Ø®ØªØ±Ø§Ù‚ ØªØ¹Ù„ÙŠÙ…ÙŠØ©, Ø£Ø¯ÙˆØ§Øª ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§, Ø¯ÙˆØ±Ø§Øª Ø¨Ø±Ù…Ø¬Ø©, Ø¯ÙˆØ±Ø§Øª ØªØµÙ…ÙŠÙ…, Ø³ÙŠØ±ÙØ±Ø§Øª Ù…Ø¯ÙÙˆØ¹Ø©, Ø³ÙŠØ±ÙØ±Ø§Øª IPTV, Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ, AI, Ø§Ø¯ÙˆØ§Øª Ù‡ÙƒØ± Ù„Ù„ØªØ¹Ù„ÙŠÙ…, Ø§Ø¯ÙˆØ§Øª Ø­Ù…Ø§ÙŠØ©, Ù‚Ù†ÙˆØ§Øª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ØªØ¹Ù„ÙŠÙ…ÙŠØ©">
  <meta name="author" content="Basm / ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ«">

  <!-- Open Graph -->
  <meta property="og:title" content="ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ« â€“ ÙƒÙˆØ±Ø³Ø§ØªØŒ Ø¨Ø±Ø§Ù…Ø¬ØŒ Ù…Ø­ØªÙˆÙ‰ VIP">
  <meta property="og:description" content="ÙƒÙˆØ±Ø³Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© ÙˆÙ…Ø¯ÙÙˆØ¹Ø©ØŒ Ø¨Ø±Ø§Ù…Ø¬ ØªØ¹Ù„ÙŠÙ…ØŒ Ø£Ø¯ÙˆØ§Øª Ù…Ù‡ÙƒØ±Ø© ÙˆÙ…Ø¹Ø¯Ù„Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŒ Ù…Ø­ØªÙˆÙ‰ VIP Ø¨Ø³Ø¹Ø± Ø±Ù…Ø²ÙŠØŒ ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯.">
  <meta property="og:image" content="https://k.top4top.io/p_3620yt6g21.jpg">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://basmali12.github.io/Mtgr2025/">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ« â€“ ÙƒÙˆØ±Ø³Ø§Øª Ùˆ Ø£Ø¯ÙˆØ§Øª VIP">
  <meta name="twitter:description" content="Ù…ØªØ¬Ø± ÙƒÙˆØ±Ø³Ø§Øª + Ø¨Ø±Ø§Ù…Ø¬ Ù…Ù‡ÙƒØ±Ø© ÙˆÙ…Ø¹Ø¯Ù„Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø© + Ø£Ø¯ÙˆØ§Øª ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø­Ø¯ÙŠØ«Ø©.">
  <meta name="twitter:image" content="https://k.top4top.io/p_3620yt6g21.jpg">

  <!-- Favicon -->
  <link rel="icon" href="https://k.top4top.io/p_3620yt6g21.jpg" type="image/jpeg">

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <style>
    :root {
      --bg: #020617;
      --card: rgba(15,23,42,0.98);
      --accent: #22d3ee;
      --accent2: #a855f7;
      --accent3: #facc15;
      --danger: #ef4444;
      --success: #10b981;
      --border: rgba(148,163,184,0.35);
      --text: #e5e7eb;
      --muted: #9ca3af;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Tajawal",system-ui,sans-serif;
      background:
        radial-gradient(circle at top,rgba(56,189,248,0.16),transparent 60%),
        radial-gradient(circle at bottom,rgba(168,85,247,0.16),transparent 55%),
        linear-gradient(135deg,#020617,#020617 40%,#030b1e);
      color:var(--text);
      min-height:100vh;
    }

    header{
      padding:10px 14px;
      border-bottom:1px solid var(--border);
      background:linear-gradient(90deg,rgba(15,23,42,0.98),rgba(15,23,42,0.9));
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .logo{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo-icon{
      width:34px;height:34px;border-radius:50%;
      border:2px solid var(--accent);
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 0 18px rgba(34,211,238,0.7);
      background:radial-gradient(circle,rgba(34,211,238,0.2),transparent);
    }
    .logo-icon img{
      width:22px;height:22px;border-radius:50%;object-fit:cover;
    }
    .logo-text{display:flex;flex-direction:column;line-height:1.1}
    .logo-title{font-size:16px;font-weight:700}
    .logo-sub{font-size:11px;color:var(--muted)}

    .header-right{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:4px;
    }

    .user-chip{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(15,23,42,0.95);
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:2px;
    }
    .user-chip span:last-child{color:var(--accent);font-weight:600}

    .account-btn{
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(15,23,42,0.96);
      color:var(--muted);
      padding:4px 8px;
      font-size:11px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }

    main{max-width:1100px;margin:10px auto 20px;padding:0 10px}

    .user-status-bar{
      background:rgba(15,23,42,0.97);
      border-radius:14px;
      border:1px solid var(--border);
      padding:8px 10px;
      margin-bottom:10px;
      display:grid;
      grid-template-columns:minmax(0,2.2fr) minmax(0,2fr);
      gap:6px;
      align-items:center;
    }
    @media(max-width:768px){
      .user-status-bar{
        grid-template-columns:1fr;
      }
    }
    .user-status-text{font-size:11px;color:var(--muted);}
    .user-status-pill{display:flex;gap:6px;align-items:center;flex-wrap:wrap;}
    .badge{
      padding:3px 7px;
      border-radius:999px;
      font-size:11px;
      border:1px solid var(--border);
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .badge.vip{border-color:var(--accent3);color:var(--accent3);}
    .badge.notvip{border-color:var(--muted);color:var(--muted);}
    .btn-vip{
      border-radius:999px;
      border:none;
      padding:6px 10px;
      font-size:11px;
      cursor:pointer;
      background:linear-gradient(90deg,#22c55e,#16a34a);
      color:#022c22;
      display:inline-flex;
      align-items:center;
      gap:5px;
      font-weight:600;
    }
    .btn-vip i{font-size:12px}
    .vip-pricing{
      font-size:11px;
      color:var(--muted);
    }
    .vip-pricing span{color:var(--accent3);font-weight:600}

    .profile-box{
      background:rgba(15,23,42,0.96);
      border-radius:14px;
      border:1px dashed rgba(148,163,184,0.7);
      padding:8px 10px;
      margin-bottom:12px;
      font-size:11px;
    }
    .profile-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
      margin-top:6px;
    }
    .profile-row input{
      background:rgba(15,23,42,0.96);
      border-radius:999px;
      border:1px solid rgba(51,65,85,0.95);
      padding:5px 8px;
      color:var(--text);
      font-size:11px;
      min-width:120px;
    }
    .profile-row button{
      border-radius:999px;
      border:none;
      padding:5px 10px;
      font-size:11px;
      cursor:pointer;
      background:rgba(37,99,235,0.95);
      color:white;
    }

    .search-box{
      margin-bottom:8px;
      display:flex;
      gap:6px;
    }
    .search-box input{
      flex:1;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(15,23,42,0.96);
      color:var(--text);
      font-size:12px;
    }
    .search-box button{
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(15,23,42,0.96);
      color:var(--muted);
      padding:4px 8px;
      font-size:11px;
      cursor:pointer;
    }

    .filters{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-bottom:8px;
      font-size:11px;
    }
    .filter-chip{
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(15,23,42,0.96);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      color:var(--muted);
    }
    .filter-chip.active{
      border-color:var(--accent);
      color:var(--accent);
      box-shadow:0 0 12px rgba(34,211,238,0.4);
    }

    .products-grid{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
    }
    @media(min-width:900px){
      .products-grid{grid-template-columns:repeat(4,minmax(0,1fr));}
    }
    @media(min-width:1200px){
      .products-grid{grid-template-columns:repeat(6,minmax(0,1fr));}
    }

    .product-card{
      background:rgba(15,23,42,0.98);
      border-radius:14px;
      border:1px solid rgba(55,65,81,0.9);
      padding:6px;
      display:flex;
      flex-direction:column;
      gap:4px;
      position:relative;
      overflow:hidden;
    }
    .product-card.vip{
      box-shadow:0 0 18px rgba(250,204,21,0.35);
      border-color:rgba(250,204,21,0.85);
    }
    .product-image-box{
      width:100%;
      padding-top:100%;
      border-radius:10px;
      overflow:hidden;
      background:radial-gradient(circle,rgba(15,23,42,0.7),#020617);
      position:relative;
    }
    .product-image-box img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .product-title{
      font-size:12px;
      font-weight:600;
      margin-top:2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .rating-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-top:3px;
      font-size:11px;
    }
    .rating-stars i{
      cursor:pointer;
      margin-inline-start:2px;
      color:#facc15;
    }
    .rating-stars i.fa-regular{opacity:0.4;}
    .rating-num{color:var(--muted);}

    .product-meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:10px;
      color:var(--muted);
      margin-top:2px;
    }

    .product-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:2px;
      gap:4px;
    }
    .category-text{font-size:10px;color:var(--muted);}
    .badge-small{
      font-size:10px;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.8);
    }
    .badge-small.vip{border-color:var(--accent3);color:var(--accent3);}

    .product-actions{
      display:flex;
      align-items:center;
      gap:4px;
    }
    .btn-enter{
      border:none;
      border-radius:999px;
      padding:4px 10px;
      font-size:11px;
      cursor:pointer;
      background:#ef4444;
      color:#fee2e2;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .btn-share{
      border:none;
      border-radius:999px;
      padding:4px 7px;
      font-size:11px;
      cursor:pointer;
      background:rgba(15,23,42,0.96);
      color:var(--muted);
      display:inline-flex;
      align-items:center;
      gap:3px;
    }

    .course-overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.96);
      z-index:40;
      display:none;
      flex-direction:column;
    }
    .course-overlay.active{display:flex;}
    .course-header{
      padding:8px 10px;
      border-bottom:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      background:rgba(15,23,42,0.98);
    }
    .course-header button{
      border:none;
      background:rgba(15,23,42,0.96);
      border-radius:999px;
      padding:4px 8px;
      color:var(--text);
      font-size:11px;
      display:inline-flex;
      align-items:center;
      gap:4px;
      cursor:pointer;
    }
    .course-title{font-size:13px;font-weight:600;}
    .course-body{
      padding:10px;
      overflow:auto;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .preview-box{
      max-width:480px;
      margin:0 auto;
      border-radius:14px;
      overflow:hidden;
      border:1px solid rgba(55,65,81,0.9);
      background:#000;
    }
    .preview-box iframe,
    .preview-box video{
      width:100%;
      height:260px;
      display:block;
    }
    @media(max-width:600px){
      .preview-box iframe,
      .preview-box video{height:210px;}
    }

    .section-box{
      background:rgba(15,23,42,0.98);
      border-radius:14px;
      border:1px solid var(--border);
      padding:8px 10px;
      font-size:12px;
    }
    .section-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:6px;
      font-size:12px;
    }
    .section-title span{display:flex;align-items:center;gap:6px;}
    .field-list{display:flex;flex-direction:column;gap:6px;}
    .field-item{
      padding:6px 8px;
      border-radius:10px;
      border:1px solid rgba(51,65,85,0.9);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
      font-size:11px;
    }
    .field-main{display:flex;align-items:center;gap:6px;}
    .field-actions a{
      font-size:11px;
      text-decoration:none;
      color:var(--accent);
    }
    .field-actions span{
      font-size:11px;
      color:#fecaca;
    }
    .vip-locked{
      font-size:11px;
      color:#fecaca;
      background:rgba(185,28,28,0.15);
      border-radius:10px;
      padding:6px 8px;
      border:1px solid rgba(248,113,113,0.7);
      margin-top:6px;
    }

    .seo-footer{
      font-size:10px;
      color:var(--muted);
      opacity:0.8;
      margin-top:12px;
      padding:0 4px 8px;
    }

    /* ÙÙ‡Ø±Ø³ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
    #coursesIndex{
      margin-top:14px;
      font-size:12px;
    }

    /* Ù†Ø§ÙØ°Ø© Ø­Ø³Ø§Ø¨ÙŠ */
    .account-modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
    }
    .account-modal.open{display:flex;}
    .account-modal::before{
      content:"";
      position:absolute;
      inset:0;
      background:rgba(15,23,42,0.8);
      backdrop-filter:blur(4px);
    }
    .account-card{
      position:relative;
      background:var(--card);
      border-radius:16px;
      border:1px solid var(--border);
      padding:14px;
      width:90%;
      max-width:360px;
      z-index:1;
      font-size:12px;
    }
    .account-row{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    .eye-btn,
    .logout-small{
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(15,23,42,0.96);
      color:var(--muted);
      padding:4px 8px;
      font-size:11px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .account-close{
      position:absolute;
      top:8px;
      inset-inline-end:8px;
      border:none;
      background:transparent;
      color:var(--muted);
      cursor:pointer;
    }

    /* Ø¥Ø¹Ù„Ø§Ù† ØªØ±Ø­ÙŠØ¨ÙŠ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ®Ø·ÙŠ */
    #welcomeAdWrapper{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:60;
    }
    #welcomeAdWrapper.active{
      display:flex;
    }
    #welcomeAdBackdrop{
      position:absolute;
      inset:0;
      background:rgba(15,23,42,0.86);
      backdrop-filter:blur(4px);
    }
    #welcomeAdBox{
      position:relative;
      z-index:1;
      max-width:420px;
      width:90%;
      background:radial-gradient(circle at top,#0f172a,#020617);
      border-radius:20px;
      border:1px solid rgba(148,163,184,0.4);
      padding:16px 14px;
      box-shadow:0 0 35px rgba(56,189,248,0.5);
    }
    #welcomeAdTitle{
      font-size:15px;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    #welcomeAdTitle i{
      color:#22d3ee;
    }
    #welcomeAdText{
      font-size:13px;
      color:#e5e7eb;
      margin-bottom:14px;
      line-height:1.7;
    }
    #welcomeAdNote{
      font-size:11px;
      color:#9ca3af;
      margin-bottom:10px;
    }
    #welcomeSkipBtn{
      display:inline-flex;
      align-items:center;
      gap:6px;
      border:none;
      border-radius:999px;
      padding:7px 14px;
      font-size:13px;
      cursor:pointer;
      background:linear-gradient(135deg,#f97316,#ec4899);
      color:#0b1120;
      font-weight:600;
    }
  </style>
</head>

<body>

<header>
  <div class="logo">
    <div class="logo-icon">
      <img src="https://k.top4top.io/p_3620yt6g21.jpg" alt="Logo">
    </div>
    <div class="logo-text">
      <div class="logo-title">ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ«</div>
      <div class="logo-sub">Ù…ØªØ¬Ø± ÙƒÙˆØ±Ø³Ø§Øª â€“ ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø­Ø¯ÙŠØ«Ø© &amp; VIP</div>
    </div>
  </div>
  <div class="header-right">
    <div class="user-chip">
      <span>Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨: <strong id="accountStateText">...</strong></span>
      <span>ID: <span id="userIdChip">----</span></span>
      <span id="visitsLabel">Ø§Ù„Ø²ÙˆØ§Ø±: --</span>
    </div>
    <button id="accountBtn" class="account-btn">
      <i class="fa-solid fa-user"></i> Ø­Ø³Ø§Ø¨ÙŠ
    </button>
  </div>
</header>

<main>

  <section class="user-status-bar">
    <div>
      <div class="user-status-text" id="vipShortText">
        ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...
      </div>
      <div class="vip-pricing">
        Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ <span>VIP</span> Ù„ÙØªØ­ Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ù…ÙˆÙ‚Ø¹:
        Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯ <span>5$</span> â€“ Ø«Ù„Ø§Ø«Ø© Ø£Ø´Ù‡Ø± <span>10$</span>.
      </div>
    </div>
    <div class="user-status-pill">
      <button class="btn-vip" id="vipWhatsappBtn">
        <i class="fa-brands fa-whatsapp"></i>
        Ø£Ø±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ VIP
      </button>
      <span class="badge" id="vipStateBadge"><i class="fa-solid fa-circle-info"></i> ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ ...</span>
    </div>
  </section>

  <section class="profile-box">
    <div>Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø­ÙÙˆØ¸ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø². Ø¥Ø°Ø§ Ø±Ø¬Ø¹Øª Ù„Ø§Ø­Ù‚Ù‹Ø§ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ <strong>ID</strong> ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±.</div>
    <div class="profile-row">
      <span>ID Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
      <span id="userIdDisplay" style="font-weight:600;"></span>
    </div>
    <div class="profile-row" id="passwordRow">
      <span>Ø£Ù†Ø´Ø¦ ÙƒÙ„Ù…Ø© Ø³Ø±:</span>
      <input type="password" id="passwordInput" placeholder="Ù¢-Ù¡Ù¢ Ø­Ø±Ù / Ø±Ù‚Ù…">
      <button id="savePasswordBtn">Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
      <span id="passwordStatus"></span>
    </div>
  </section>

  <section class="search-box">
    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒÙˆØ±Ø³ Ø£Ùˆ ØªØ·Ø¨ÙŠÙ‚ Ø£Ùˆ Ù…Ù†ØªØ¬...">
    <button id="clearSearchBtn"><i class="fa-solid fa-xmark"></i></button>
  </section>

  <section class="filters">
    <button class="filter-chip active" data-filter="all">Ø§Ù„ÙƒÙ„</button>
    <button class="filter-chip" data-filter="public">Ù…ÙØªÙˆØ­</button>
    <button class="filter-chip" data-filter="vip">VIP</button>
  </section>

  <section class="products-grid" id="productsGrid"></section>

  <!-- ÙÙ‡Ø±Ø³ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„ØªØµØ¯Ø± ÙÙŠ Ø§Ù„Ø¨Ø­Ø« -->
  <section id="coursesIndex">
    <h2 style="font-size:13px;margin-bottom:6px;">ÙÙ‡Ø±Ø³ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„ØªØµÙ†ÙŠÙØ§Øª</h2>
    <ul id="coursesIndexList" style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:4px;"></ul>
  </section>

  <footer class="seo-footer">
    ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ« Ù‡Ùˆ Ù…ØªØ¬Ø± ÙƒÙˆØ±Ø³Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© ÙˆÙ…Ø¯ÙÙˆØ¹Ø©ØŒ ÙƒÙˆØ±Ø³Ø§Øª VIPØŒ Ø¨Ø±Ø§Ù…Ø¬ ØªØ¹Ù„ÙŠÙ…ØŒ ØªØ·Ø¨ÙŠÙ‚Ø§ØªØŒ Ø³ÙƒØ±Ø¨ØªØ§ØªØŒ Ø¨Ø±Ø§Ù…Ø¬ Ù…Ù‡ÙƒØ±Ø© ÙˆÙ…Ø¹Ø¯Ù„Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŒ Ø£Ø¯ÙˆØ§Øª Ù‡ÙƒØ± ØªØ¹Ù„ÙŠÙ…ÙŠØ©ØŒ Ø£Ø¯ÙˆØ§Øª Ø­Ù…Ø§ÙŠØ©ØŒ Ù‚ÙˆØ§Ù„Ø¨ Ø¬Ø§Ù‡Ø²Ø©ØŒ Ø³ÙŠØ±ÙØ±Ø§ØªØŒ ÙˆØ«ØºØ±Ø§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©.
  </footer>

</main>

<!-- Ø¥Ø¹Ù„Ø§Ù† ØªØ±Ø­ÙŠØ¨ÙŠ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ®Ø·ÙŠ -->
<div id="welcomeAdWrapper">
  <div id="welcomeAdBackdrop"></div>
  <div id="welcomeAdBox">
    <div id="welcomeAdTitle">
      <i class="fa-solid fa-bullhorn"></i>
      <span>Ø¥Ø¹Ù„Ø§Ù† Ù…Ù† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±</span>
    </div>
    <div id="welcomeAdText"></div>
    <div id="welcomeAdNote">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥ØºÙ„Ø§Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± ØªØ®Ø·ÙŠ.</div>
    <button id="welcomeSkipBtn">
      <i class="fa-solid fa-arrow-left"></i>
      ØªØ®Ø·ÙŠ
    </button>
  </div>
</div>

<div class="course-overlay" id="courseOverlay">
  <div class="course-header">
    <button id="courseBackBtn"><i class="fa-solid fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±</button>
    <div class="course-title" id="courseTitleHead"></div>
  </div>
  <div class="course-body">
    <div id="coursePreview" class="preview-box" style="display:none;"></div>

    <div class="section-box" id="openSection">
      <div class="section-title">
        <span><i class="fa-solid fa-unlock"></i> Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙØªÙˆØ­ / Ø§Ù„Ù‚Ø¯ÙŠÙ…</span>
        <small style="color:var(--muted);font-size:10px;">ÙŠÙØ¹Ø±Ø¶ Ù„Ù„Ø¬Ù…ÙŠØ¹</small>
      </div>
      <div class="field-list" id="openFields"></div>
      <div id="noOpenFields" style="font-size:11px;color:var(--muted);display:none;">
        Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù‚ÙˆÙ„ Ù…ÙØªÙˆØ­Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ±Ø³ Ø­Ø§Ù„ÙŠÙ‹Ø§.
      </div>
    </div>

    <div class="section-box" id="vipSection">
      <div class="section-title">
        <span><i class="fa-solid fa-crown"></i> Ù…Ø­ØªÙˆÙ‰ VIP</span>
        <span class="badge-small vip" id="vipSectionBadge">Ù…Ù‚ÙÙˆÙ„</span>
      </div>
      <div class="field-list" id="vipFields"></div>
      <div class="vip-locked" id="vipLockedMsg">
        Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ VIP â€“ Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„ÙƒÙŠ ØªØªÙ…ØªØ¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù‚ÙÙˆÙ„Ø©.
        Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨.
      </div>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø­Ø³Ø§Ø¨ÙŠ -->
<div id="accountModal" class="account-modal">
  <div class="account-card">
    <button class="account-close" id="accountCloseBtn"><i class="fa-solid fa-xmark"></i></button>
    <h3 style="font-size:14px;margin-bottom:4px;">Ø­Ø³Ø§Ø¨ÙŠ</h3>
    <p style="font-size:11px;color:var(--muted);">Ù‡Ø°Ù‡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².</p>
    <div class="account-row">
      <span>ID:</span>
      <span id="accIdText" style="font-weight:600;"></span>
    </div>
    <div class="account-row">
      <span>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:</span>
      <span id="accPassText" style="direction:ltr;"></span>
      <button class="eye-btn" id="passEyeBtn"><i class="fa-solid fa-eye"></i></button>
    </div>
    <div id="accNote" style="font-size:10px;color:var(--muted);margin-top:6px;"></div>
    <div style="margin-top:10px;text-align:left;">
      <button class="logout-small" id="storeLogoutBtn">
        <i class="fa-solid fa-arrow-right-from-bracket"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
      </button>
    </div>
  </div>
</div>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDa_20ADHMOiUhueZL9PS3WHmA89fGLfhk",
    authDomain: "mtgr-5feb9.firebaseapp.com",
    projectId: "mtgr-5feb9",
    storageBucket: "mtgr-5feb9.firebasestorage.app",
    messagingSenderId: "1097780736802",
    appId: "1:1097780736802:web:89ea173d277ce529a56b7b",
    measurementId: "G-JWNEHDQ31F"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const WHATSAPP_NUMBER = "9647729373260";

  // ğŸ”¹ Ù†ÙØ³ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù„ÙŠ Ø¬Ø±Ø¨Ù†Ø§Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØµØºÙŠØ±
  function normalizeDriveImageUrl(url){
    if(!url) return "";
    try{
      if(url.includes("drive.google.com/thumbnail")) return url;

      let fileId = null;

      if(url.includes("/d/")){
        const m = url.match(/\/d\/([^/]+)/);
        if(m && m[1]) fileId = m[1];
      }

      if(!fileId && url.includes("id=")){
        const m2 = url.match(/[?&]id=([^&]+)/);
        if(m2 && m2[1]) fileId = m2[1];
      }

      if(fileId){
        return "https://drive.google.com/thumbnail?id="+fileId+"&sz=w1000";
      }
      return url;
    }catch(e){
      return url;
    }
  }

  let currentUserId = null;
  let isVip = false;
  let vipUntil = null;
  let products = [];
  let currentFilter = "all";
  let searchTerm = "";
  let userPassword = null;
  let passTimer = null;
  let ratedProducts = JSON.parse(localStorage.getItem("FTM_RATED") || "[]");

  const userIdChip      = document.getElementById("userIdChip");
  const userIdDisplay   = document.getElementById("userIdDisplay");
  const accountStateTxt = document.getElementById("accountStateText");
  const vipShortText    = document.getElementById("vipShortText");
  const vipStateBadge   = document.getElementById("vipStateBadge");
  const vipBtn          = document.getElementById("vipWhatsappBtn");
  const visitsLabel     = document.getElementById("visitsLabel");

  const passwordInput  = document.getElementById("passwordInput");
  const savePassBtn    = document.getElementById("savePasswordBtn");
  const passwordStatus = document.getElementById("passwordStatus");
  const passwordRow    = document.getElementById("passwordRow");

  const productsGrid   = document.getElementById("productsGrid");
  const filterChips    = document.querySelectorAll(".filter-chip");
  const searchInput    = document.getElementById("searchInput");
  const clearSearchBtn = document.getElementById("clearSearchBtn");

  const overlay        = document.getElementById("courseOverlay");
  const backBtn        = document.getElementById("courseBackBtn");
  const courseTitleHead= document.getElementById("courseTitleHead");
  const coursePreview  = document.getElementById("coursePreview");
  const openFieldsBox  = document.getElementById("openFields");
  const vipFieldsBox   = document.getElementById("vipFields");
  const noOpenFields   = document.getElementById("noOpenFields");
  const vipLockedMsg   = document.getElementById("vipLockedMsg");
  const vipSectionBadge= document.getElementById("vipSectionBadge");

  const accountBtn     = document.getElementById("accountBtn");
  const accountModal   = document.getElementById("accountModal");
  const accountCloseBtn= document.getElementById("accountCloseBtn");
  const accIdText      = document.getElementById("accIdText");
  const accPassText    = document.getElementById("accPassText");
  const passEyeBtn     = document.getElementById("passEyeBtn");
  const accNote        = document.getElementById("accNote");
  const storeLogoutBtn = document.getElementById("storeLogoutBtn");

  const welcomeAdWrapper = document.getElementById("welcomeAdWrapper");
  const welcomeAdTextEl  = document.getElementById("welcomeAdText");
  const welcomeSkipBtn   = document.getElementById("welcomeSkipBtn");

  function showWelcomeAd(message){
    if(!welcomeAdWrapper || !welcomeAdTextEl) return;
    welcomeAdTextEl.textContent = message;
    welcomeAdWrapper.classList.add("active");
  }

  if(welcomeSkipBtn && welcomeAdWrapper){
    welcomeSkipBtn.addEventListener("click", ()=>{
      welcomeAdWrapper.classList.remove("active");
    });
  }

  async function loadWelcomeAd(){
    try{
      const snap = await db.collection("config").doc("store").get();
      if(!snap.exists) return;
      const data = snap.data() || {};
      if(data.welcomeEnabled === true && data.welcomeText && String(data.welcomeText).trim() !== ""){
        showWelcomeAd(String(data.welcomeText));
      }
    }catch(err){
      console.error("welcomeAd error:", err);
    }
  }

  function generateUserId(){
    const rand = Math.floor(100000 + Math.random()*900000);
    return "U" + rand;
  }

  async function initUser(){
    currentUserId = localStorage.getItem("FTM_USER_ID");
    let userPassLS  = localStorage.getItem("FTM_USER_PASS");

    if(!currentUserId){
      currentUserId = generateUserId();
      localStorage.setItem("FTM_USER_ID", currentUserId);
    }

    userIdChip.textContent    = currentUserId;
    userIdDisplay.textContent = currentUserId;

    const userRef  = db.collection("users").doc(currentUserId);
    const userSnap = await userRef.get();

    if(!userSnap.exists){
      userPassword = userPassLS || "";
      await userRef.set({
        id: currentUserId,
        password: userPassword || "",
        isVip: false,
        vipUntil: null,
        createdAt: new Date().toISOString()
      });
      isVip = false;
      vipUntil = null;
    }else{
      const data = userSnap.data();
      isVip = !!data.isVip;
      vipUntil = data.vipUntil ? new Date(data.vipUntil) : null;
      userPassword = data.password || userPassLS || "";
    }

    if(userPassword){
      localStorage.setItem("FTM_USER_PASS", userPassword);
      passwordInput.value = "";
      passwordRow.style.display = "none";
      passwordStatus.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù…Ø­ÙÙˆØ¸Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡Ø§ Ù…Ù† Ø£ÙŠÙ‚ÙˆÙ†Ø© (Ø­Ø³Ø§Ø¨ÙŠ) ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰.";
      passwordStatus.style.color = "#9ca3af";
    }else if(userPassLS){
      passwordInput.value = userPassLS;
    }

    updateVipUI();

    const baseText = encodeURIComponent("Ø£Ø±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ VIP ÙÙŠ Ù…ØªØ¬Ø± ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ«. ID: " + currentUserId);
    const waLink = "https://wa.me/" + WHATSAPP_NUMBER + "?text=" + baseText;
    vipBtn.addEventListener("click", () => {
      window.open(waLink, "_blank");
    });
  }

  function updateVipUI(){
    const now = new Date();
    let activeVip = false;
    if(isVip && vipUntil && vipUntil > now) {
      activeVip = true;
    }

    if(activeVip){
      accountStateTxt.textContent = "Ù…Ø´ØªØ±Ùƒ (VIP)";
      accountStateTxt.style.color = "#22c55e";
      vipShortText.textContent = "Ø­Ø³Ø§Ø¨Ùƒ Ù…ÙØ¹Ù„ VIP â€“ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù‚ÙÙˆÙ„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª.";
      vipStateBadge.innerHTML = '<i class="fa-solid fa-crown"></i> Ø­Ø³Ø§Ø¨Ùƒ VIP Ù†Ø´Ø·';
      vipStateBadge.classList.remove("notvip");
      vipStateBadge.classList.add("vip");
      vipLockedMsg.style.display = "none";
      vipSectionBadge.textContent = "Ù…ÙØªÙˆØ­ Ù„Ùƒ";
    }else{
      accountStateTxt.textContent = "ØºÙŠØ± Ù…Ø´ØªØ±Ùƒ";
      accountStateTxt.style.color = "#f97316";
      vipShortText.textContent = "Ø­Ø§Ù„ÙŠØ§Ù‹ ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ â€“ ÙŠÙ…ÙƒÙ† Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙØªÙˆØ­ ÙÙ‚Ø·ØŒ Ù…Ø­ØªÙˆÙ‰ VIP ÙŠØ­ØªØ§Ø¬ Ø§Ø´ØªØ±Ø§Ùƒ.";
      vipStateBadge.innerHTML = '<i class="fa-solid fa-lock"></i> ØºÙŠØ± Ù…Ø´ØªØ±Ùƒ';
      vipStateBadge.classList.remove("vip");
      vipStateBadge.classList.add("notvip");
      vipLockedMsg.style.display = "block";
      vipSectionBadge.textContent = "Ù…Ù‚ÙÙˆÙ„";
    }
  }

  async function initVisitors(){
    if(!visitsLabel) return;
    try{
      const ref = db.collection("stats").doc("global");
      const newCount = await db.runTransaction(async (tx)=>{
        const snap = await tx.get(ref);
        let current = 0;
        if(snap.exists && typeof snap.data().visits === "number"){
          current = snap.data().visits;
        }
        const next = current + 1;
        tx.set(ref,{visits:next},{merge:true});
        return next;
      });
      visitsLabel.textContent = "Ø§Ù„Ø²ÙˆØ§Ø±: " + newCount;
    }catch(e){
      console.error(e);
      visitsLabel.textContent = "Ø§Ù„Ø²ÙˆØ§Ø±: --";
    }
  }

  savePassBtn.addEventListener("click", async () => {
    const pass = passwordInput.value.trim();
    if(pass.length < 2 || pass.length > 12){
      passwordStatus.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø¨ÙŠÙ† Ù¢ ÙˆÙ¡Ù¢ Ø±Ù…Ø².";
      passwordStatus.style.color = "#fecaca";
      return;
    }
    try{
      await db.collection("users").doc(currentUserId).set({
        id: currentUserId,
        password: pass,
        isVip,
        vipUntil: vipUntil ? vipUntil.toISOString() : null
      }, { merge:true });

      localStorage.setItem("FTM_USER_PASS", pass);
      userPassword = pass;
      passwordStatus.textContent = "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨.";
      passwordStatus.style.color = "#22c55e";
      passwordRow.style.display = "none";
    }catch(e){
      console.error(e);
      passwordStatus.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸.";
      passwordStatus.style.color = "#fecaca";
    }
  });

  searchInput.addEventListener("input", ()=>{
    searchTerm = searchInput.value.trim().toLowerCase();
    renderProducts();
    renderCoursesIndex();
  });
  clearSearchBtn.addEventListener("click", ()=>{
    searchInput.value = "";
    searchTerm = "";
    renderProducts();
    renderCoursesIndex();
  });

  async function loadProducts(){
    const snap = await db.collection("products").orderBy("id","asc").get();
    products = [];
    snap.forEach(docSnap => {
      const data = docSnap.data();
      products.push(data);
    });
    renderProducts();
    renderCoursesIndex();

    const params = new URLSearchParams(window.location.search);
    const pid = params.get("p");
    if(pid){
      const prod = products.find(p => String(p.id) === String(pid));
      if(prod) openCourse(prod);
    }
  }

  function renderProducts(){
    productsGrid.innerHTML = "";
    const filtered = products.filter(p => {
      if(searchTerm){
        const t = (p.title || "").toLowerCase();
        const c = (p.category || "").toLowerCase();
        if(!t.includes(searchTerm) && !c.includes(searchTerm)) return false;
      }
      if(currentFilter === "public"){
        return Array.isArray(p.resources) && p.resources.some(r => r.access === "public");
      }
      if(currentFilter === "vip"){
        return Array.isArray(p.resources) && p.resources.some(r => r.access === "vip");
      }
      return true;
    });

    filtered.forEach(p => {
      const card = document.createElement("article");
      card.className = "product-card" + (p.accessVip ? " vip" : "");

      // ğŸ”¹ Ù†Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù‡Ù†Ø§
      const imgUrlRaw = p.image || "";
      const imgUrl    = normalizeDriveImageUrl(imgUrlRaw);

      const ratingSum   = typeof p.ratingSum === "number" ? p.ratingSum : 0;
      const ratingCount = typeof p.ratingCount === "number" ? p.ratingCount : 0;
      const avgRating   = ratingCount > 0 ? (ratingSum / ratingCount) : 0;
      const rounded     = Math.round(avgRating || 0);

      const ratingHtml = `
        <div class="rating-row">
          <div class="rating-stars">
            ${[1,2,3,4,5].map(i=>`
              <i class="fa-star ${i <= rounded ? 'fa-solid' : 'fa-regular'}" data-value="${i}"></i>
            `).join('')}
          </div>
          <div class="rating-num">${avgRating ? avgRating.toFixed(1) : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…'}</div>
        </div>
      `;

      card.innerHTML = `
        <div class="product-image-box">
          ${imgUrl ? `<img src="${imgUrl}" alt="">` : ""}
        </div>
        <div class="product-title">${p.title || "Ù…Ù†ØªØ¬ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"}</div>
        ${ratingHtml}
        <div class="product-meta">
          <span>ID: ${p.id ?? "-"}</span>
          <span>${p.category || ""}</span>
        </div>
        <div class="product-footer">
          <div>
            <div class="category-text">${p.category || ""}</div>
            ${p.accessVip ? '<span class="badge-small vip">VIP</span>' : '<span class="badge-small">Ù…ÙØªÙˆØ­</span>'}
          </div>
          <div class="product-actions">
            <button class="btn-share" title="Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬"><i class="fa-solid fa-share-nodes"></i></button>
            <button class="btn-enter"><i class="fa-solid fa-arrow-left"></i> Ø¯Ø®ÙˆÙ„</button>
          </div>
        </div>
      `;

      card.querySelector(".btn-enter").addEventListener("click", () => openCourse(p));

      const stars = card.querySelectorAll(".rating-stars i");
      stars.forEach(star=>{
        star.addEventListener("click", ()=>{
          const val = parseInt(star.dataset.value,10) || 0;
          rateProduct(p, val);
        });
      });

      const shareBtn = card.querySelector(".btn-share");
      shareBtn.addEventListener("click", ()=> shareProduct(p));

      productsGrid.appendChild(card);
    });

    if(!filtered.length){
      const empty = document.createElement("div");
      empty.style.gridColumn = "1 / -1";
      empty.style.fontSize = "12px";
      empty.style.color = "var(--muted)";
      empty.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ± Ø­Ø§Ù„ÙŠØ§Ù‹.";
      productsGrid.appendChild(empty);
    }
  }

  function renderCoursesIndex(){
    const ul = document.getElementById("coursesIndexList");
    if(!ul) return;
    ul.innerHTML = "";

    const list = products.filter(p=>{
      if(searchTerm){
        const t = (p.title || "").toLowerCase();
        const c = (p.category || "").toLowerCase();
        if(!t.includes(searchTerm) && !c.includes(searchTerm)) return false;
      }
      return p.id && p.title;
    });

    list.forEach(p=>{
      const cat = (p.category || "").toLowerCase();
      let catLabel = "Ù…Ù†ØªØ¬";
      if (cat.includes("course"))   catLabel = "ÙƒÙˆØ±Ø³ ØªØ¹Ù„ÙŠÙ…ÙŠ";
      else if (cat.includes("app")) catLabel = "ØªØ·Ø¨ÙŠÙ‚";
      else if (cat.includes("script")) catLabel = "Ø³ÙƒØ±Ø¨Øª";
      else if (cat.includes("template")) catLabel = "Ù‚Ø§Ù„Ø¨ Ø¬Ø§Ù‡Ø²";
      else if (cat.includes("tool")) catLabel = "Ø£Ø¯Ø§Ø© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ©";

      const li = document.createElement("li");
      const a  = document.createElement("a");
      a.href = "?p=" + encodeURIComponent(p.id);
      a.textContent = `${p.title} â€“ ${catLabel} Ù…Ù† Ù…ØªØ¬Ø± ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ« (ID: ${p.id})`;
      a.style.color = "#9ca3af";
      a.style.textDecoration = "none";
      li.appendChild(a);
      ul.appendChild(li);
    });
  }

  filterChips.forEach(chip => {
    chip.addEventListener("click", () => {
      filterChips.forEach(c => c.classList.remove("active"));
      chip.classList.add("active");
      currentFilter = chip.dataset.filter;
      renderProducts();
      renderCoursesIndex();
    });
  });

  function isVideoUrl(url){
    if(!url) return false;
    const u = url.toLowerCase();
    return u.includes("youtube.com") || u.includes("youtu.be") ||
           u.endsWith(".mp4") || u.endsWith(".webm") || u.endsWith(".ogg");
  }

  function buildVideoElement(url, poster){
    if(url.includes("youtube.com") || url.includes("youtu.be")){
      let videoId = "";
      try{
        if(url.includes("youtube.com")){
          const params = new URL(url).searchParams;
          videoId = params.get("v") || "";
        }else{
          const parts = url.split("/");
          videoId = parts[parts.length - 1];
        }
      }catch(e){}
      if(!videoId) return `<a href="${url}" target="_blank">ÙØªØ­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</a>`;
      const embed = "https://www.youtube.com/embed/" + videoId;
      return `<iframe src="${embed}" frameborder="0" allowfullscreen></iframe>`;
    }else{
      const posterAttr = poster ? ` poster="${poster}"` : "";
      return `<video controls src="${url}"${posterAttr}></video>`;
    }
  }

  function openCourse(product){
    overlay.classList.add("active");
    courseTitleHead.textContent = product.title || "";

    coursePreview.innerHTML = "";
    coursePreview.style.display = "none";
    openFieldsBox.innerHTML = "";
    vipFieldsBox.innerHTML  = "";

    let anyOpen = false;
    let anyVip  = false;
    let previewSet = false;

    const now = new Date();
    const activeVip = isVip && vipUntil && vipUntil > now;

    if(Array.isArray(product.resources)){
      product.resources.forEach((r, index) => {
        const isVid = isVideoUrl(r.url);
        const title = r.title || ("Ø¹Ù†ØµØ± " + (index+1));

        if(isVid && !previewSet && ((r.access !== "vip") || (r.access === "vip" && activeVip))){
          // ğŸ”¹ Ù†Ø³ØªØ®Ø¯Ù… ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨ÙˆØ³ØªØ± Ù„Ù„ÙÙŠØ¯ÙŠÙˆ
          const poster = normalizeDriveImageUrl(product.image || "");
          coursePreview.innerHTML = buildVideoElement(r.url, poster);
          coursePreview.style.display = "block";
          previewSet = true;
          return;
        }

        if(r.access === "vip"){
          anyVip = true;
          const item = document.createElement("div");
          item.className = "field-item";
          item.innerHTML = `
            <div class="field-main">
              <i class="fa-solid fa-crown" style="color:var(--accent3);"></i>
              <span>${title}</span>
            </div>
            <div class="field-actions">
              ${
                activeVip
                  ? (isVid ? '<a href="'+r.url+'" target="_blank">ÙØªØ­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</a>'
                           : '<a href="'+r.url+'" target="_blank">ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·</a>')
                  : '<span>VIP Ù…Ù‚ÙÙˆÙ„</span>'
              }
            </div>
          `;
          vipFieldsBox.appendChild(item);
        }else{
          anyOpen = true;
          const item = document.createElement("div");
          item.className = "field-item";
          item.innerHTML = `
            <div class="field-main">
              <i class="fa-solid fa-circle-play" style="color:var(--accent);"></i>
              <span>${title}</span>
            </div>
            <div class="field-actions">
              ${
                isVid
                  ? '<a href="'+r.url+'" target="_blank">ÙØªØ­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</a>'
                  : '<a href="'+r.url+'" target="_blank">ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·</a>'
              }
            </div>
          `;
          openFieldsBox.appendChild(item);
        }
      });
    }

    noOpenFields.style.display = anyOpen ? "none" : "block";

    if(!anyVip){
      vipFieldsBox.innerHTML = '<div style="font-size:11px;color:var(--muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù‚ÙˆÙ„ VIP ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ±Ø³.</div>';
      vipLockedMsg.style.display = "none";
      vipSectionBadge.textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ VIP";
    }else{
      if(activeVip){
        vipLockedMsg.style.display = "none";
        vipSectionBadge.textContent = "Ù…ÙØªÙˆØ­ Ù„Ùƒ";
      }else{
        vipLockedMsg.style.display = "block";
        vipSectionBadge.textContent = "Ù…Ù‚ÙÙˆÙ„";
      }
    }
  }

  backBtn.addEventListener("click", () => {
    overlay.classList.remove("active");
  });

  function maskPassword(p){
    if(!p) return "Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø³Ø±";
    return "â€¢".repeat(Math.max(p.length,4));
  }

  accountBtn.addEventListener("click", ()=>{
    accountModal.classList.add("open");
    accIdText.textContent = currentUserId || "--";
    if(userPassword){
      accPassText.textContent = maskPassword(userPassword);
      passEyeBtn.disabled = false;
      accNote.textContent = "ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù…Ø¯Ø© Ù£Ù  Ø«Ø§Ù†ÙŠØ© ÙÙ‚Ø·.";
    }else{
      accPassText.textContent = "Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø³Ø± Ø¨Ø¹Ø¯.";
      passEyeBtn.disabled = true;
      accNote.textContent = "Ù‚Ù… Ø¨ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø³Ø± Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚ (Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨) ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„.";
    }
  });

  accountCloseBtn.addEventListener("click", ()=>{
    accountModal.classList.remove("open");
    if(passTimer){clearTimeout(passTimer);passTimer=null;}
  });
  accountModal.addEventListener("click", (e)=>{
    if(e.target === accountModal){
      accountCloseBtn.click();
    }
  });

  passEyeBtn.addEventListener("click", ()=>{
    if(!userPassword) return;
    if(passTimer){clearTimeout(passTimer);}
    accPassText.textContent = userPassword;
    passEyeBtn.disabled = true;
    accNote.textContent = "Ø³ÙŠØªÙ… Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ù£Ù  Ø«Ø§Ù†ÙŠØ©.";
    passTimer = setTimeout(()=>{
      accPassText.textContent = maskPassword(userPassword);
      passEyeBtn.disabled = false;
      accNote.textContent = "ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù…Ø¯Ø© Ù£Ù  Ø«Ø§Ù†ÙŠØ© ÙÙ‚Ø·.";
    }, 30000);
  });

  if(storeLogoutBtn){
    storeLogoutBtn.addEventListener("click", ()=>{
      localStorage.removeItem("FTM_USER_ID");
      localStorage.removeItem("FTM_USER_PASS");
      location.href = location.pathname;
    });
  }

  function shareProduct(p){
    const baseUrl = window.location.origin + window.location.pathname;
    const url = baseUrl + "?p=" + encodeURIComponent(p.id);
    const text = "Ø´ÙˆÙ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ù…ØªØ¬Ø± ÙÙ† Ø§Ù„ØªÙƒÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø­Ø¯ÙŠØ«: " + (p.title || "Ù…Ù†ØªØ¬");
    if(navigator.share){
      navigator.share({
        title: p.title || "Ù…Ù†ØªØ¬",
        text,
        url
      }).catch(()=>{});
    }else{
      if(navigator.clipboard){
        navigator.clipboard.writeText(url).then(()=>{
          alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬:\n" + url);
        }).catch(()=>{
          alert("Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬:\n" + url);
        });
      }else{
        alert("Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬:\n" + url);
      }
    }
  }

  function rateProduct(product, value){
    if(!value || value < 1 || value > 5) return;
    if(ratedProducts.includes(product.id)){
      alert("Ù‚ÙŠÙ‘Ù…Øª Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ù‚Ø¨Ù„.");
      return;
    }
    const ref = db.collection("products").doc(String(product.id));
    ref.set({
      ratingSum: firebase.firestore.FieldValue.increment(value),
      ratingCount: firebase.firestore.FieldValue.increment(1)
    }, {merge:true})
    .then(()=>{
      ratedProducts.push(product.id);
      localStorage.setItem("FTM_RATED", JSON.stringify(ratedProducts));
      loadProducts();
    })
    .catch(err=>{
      console.error(err);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ….");
    });
  }

  (async function start(){
    await initUser();
    await initVisitors();
    await loadProducts();
    await loadWelcomeAd();
  })();
</script>

</body>
</html>
